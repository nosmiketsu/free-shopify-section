<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Purolator Shipping Quote</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom scrollbar for better UX in package list */
    #package-list::-webkit-scrollbar {
      height: 6px;
    }
    #package-list::-webkit-scrollbar-thumb {
      background-color: rgba(0,0,0,0.15);
      border-radius: 10px;
    }
    #package-list::-webkit-scrollbar-track {
      background: transparent;
    }
    /* Tab styles */
    .tab {
      @apply cursor-pointer font-semibold text-gray-400 px-4 py-3 rounded-t;
      transition: color 0.3s, border-color 0.3s;
    }
    .tab.active {
      @apply text-gray-900 border-b-2 border-red-600;
    }
    /* Toggle switch styles */
    .toggle {
      @apply relative w-16 h-8 bg-gray-200 rounded-full cursor-pointer;
      transition: background-color 0.3s ease-in-out;
    }
    .toggle.checked {
      background-color: #111827; /* Tailwind dark gray */
    }
    .toggle-ball {
      @apply absolute left-1 top-1 w-6 h-6 bg-white rounded-full shadow transform transition-transform duration-300;
    }
    .toggle.checked .toggle-ball {
      transform: translateX(32px);
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">
  <main class="bg-white max-w-5xl w-full rounded-xl shadow-md border border-gray-200 p-8">
    <!-- Tabs -->
    <nav class="flex space-x-12 border-b border-gray-200 mb-6 select-none">
      <button class="tab active" data-tab="parcel" aria-selected="true" role="tab" id="tab-parcel">Parcel</button>
      <button class="tab" data-tab="envelope" aria-selected="false" role="tab" id="tab-envelope">Envelope</button>
      <button class="tab" data-tab="ltl" aria-selected="false" role="tab" id="tab-ltl">LTL</button>
      <button class="tab" data-tab="pak" aria-selected="false" role="tab" id="tab-pak">Pak</button>
    </nav>

    <!-- Unit toggle -->
    <div class="flex justify-end mb-6">
      <div id="unit-toggle" aria-label="Toggle units" role="switch" aria-checked="false" tabindex="0" class="toggle" >
        <div class="toggle-ball"></div>
      </div>
      <div class="ml-3 flex space-x-2 text-sm font-medium text-gray-500 select-none">
        <span id="unit-label-imperial" class="text-gray-900">Imperial</span>
        <span id="unit-label-metric">Metric</span>
      </div>
    </div>

    <!-- Form -->
    <form id="shipping-form" novalidate>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 relative">
        <!-- Shipping From -->
        <fieldset class="space-y-4" aria-labelledby="from-legend">
          <legend id="from-legend" class="font-semibold text-gray-800 mb-1">Shipping from</legend>
          <select id="from-country" name="fromCountry" required aria-required="true"
            class="w-full rounded border border-gray-300 text-gray-700 px-4 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none focus:border-red-600">
            <option value="" disabled selected>Pick country</option>
            <option value="CA">Canada</option>
            <option value="US">United States</option>
            <option value="MX">Mexico</option>
            <option value="GB">United Kingdom</option>
            <option value="FR">France</option>
            <option value="DE">Germany</option>
          </select>
          <div class="flex space-x-4">
            <input type="text" id="from-postal" name="fromPostal" placeholder="Postal code"
              class="flex-1 rounded border border-gray-300 text-gray-700 px-4 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none focus:border-red-600" />
            <input type="text" id="from-city" name="fromCity" placeholder="City"
              class="flex-1 rounded border border-gray-300 text-gray-700 px-4 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none focus:border-red-600" />
          </div>
          <label class="inline-flex items-center space-x-2 cursor-pointer select-none text-gray-700">
            <input type="checkbox" id="from-residential" name="fromResidential" class="rounded focus:ring-2 focus:ring-red-600" />
            <span>Residential</span>
          </label>
        </fieldset>

        <!-- Shipping To -->
        <fieldset class="space-y-4" aria-labelledby="to-legend">
          <legend id="to-legend" class="font-semibold text-gray-800 mb-1">Shipping to</legend>
          <select id="to-country" name="toCountry" required aria-required="true"
            class="w-full rounded border border-gray-300 text-gray-700 px-4 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none focus:border-red-600">
            <option value="" disabled selected>Pick country</option>
            <option value="CA">Canada</option>
            <option value="US">United States</option>
            <option value="MX">Mexico</option>
            <option value="GB">United Kingdom</option>
            <option value="FR">France</option>
            <option value="DE">Germany</option>
          </select>
          <div class="flex space-x-4">
            <input type="text" id="to-postal" name="toPostal" placeholder="Postal code"
              class="flex-1 rounded border border-gray-300 text-gray-700 px-4 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none focus:border-red-600" />
            <input type="text" id="to-city" name="toCity" placeholder="City"
              class="flex-1 rounded border border-gray-300 text-gray-700 px-4 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none focus:border-red-600" />
          </div>
          <label class="inline-flex items-center space-x-2 cursor-pointer select-none text-gray-700">
            <input type="checkbox" id="to-residential" name="toResidential" class="rounded focus:ring-2 focus:ring-red-600" />
            <span>Residential</span>
          </label>
        </fieldset>

        <!-- Truck Icon separator -->
        <div aria-hidden="true"
          class="absolute hidden md:flex flex-col justify-center items-center bg-white rounded-full p-3 border border-gray-200 w-14 h-14 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 shadow-md">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-6a2 2 0 012-2h3.6l3 3v5a2 2 0 01-2 2h-1a3 3 0 11-6 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 17h-2a3 3 0 00-3 3" />
          </svg>
        </div>
      </div>

      <!-- Dimensions inputs -->
      <section class="mt-8 grid grid-cols-1 sm:grid-cols-4 gap-4" aria-label="Package dimensions and weight">
        <label for="length" class="flex flex-col space-y-1">
          <span class="text-sm font-semibold text-gray-700">Length (<span id="unit-dim-label">inches</span>)</span>
          <input type="number" min="0" step="any" id="length" name="length" placeholder="Length"
            class="rounded border border-gray-300 text-gray-700 px-4 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none focus:border-red-600" />
        </label>
        <label for="width" class="flex flex-col space-y-1">
          <span class="text-sm font-semibold text-gray-700">Width (<span id="unit-dim-label">inches</span>)</span>
          <input type="number" min="0" step="any" id="width" name="width" placeholder="Width"
            class="rounded border border-gray-300 text-gray-700 px-4 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none focus:border-red-600" />
        </label>
        <label for="height" class="flex flex-col space-y-1">
          <span class="text-sm font-semibold text-gray-700">Height (<span id="unit-dim-label">inches</span>)</span>
          <input type="number" min="0" step="any" id="height" name="height" placeholder="Height"
            class="rounded border border-gray-300 text-gray-700 px-4 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none focus:border-red-600" />
        </label>
        <label for="weight" class="flex flex-col space-y-1">
          <span class="text-sm font-semibold text-gray-700">Weight (<span id="unit-weight-label">Lbs</span>)</span>
          <input type="number" min="0" step="any" id="weight" name="weight" placeholder="Lbs"
            class="rounded border border-gray-300 text-gray-700 px-4 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none focus:border-red-600" />
        </label>
      </section>

      <!-- Package list and Add package -->
      <section class="mt-6">
        <button type="button" id="add-package" aria-label="Add a Package to this Shipment" class="flex items-center space-x-2 text-gray-700 font-semibold hover:text-red-600 focus:outline-none focus:ring-2 focus:ring-red-600 rounded">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3" aria-hidden="true" focusable="false">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
          </svg>
          <span>Add a Package to this Shipment</span>
        </button>
        <ul id="package-list" class="mt-4 max-h-40 overflow-y-auto space-y-3 border border-gray-200 rounded-md p-4 bg-gray-50" aria-live="polite" aria-relevant="additions removals"></ul>
      </section>

      <!-- Get a Quote -->
      <div class="mt-8 flex justify-end">
        <button type="submit"
          class="bg-red-600 hover:bg-red-700 focus:ring-4 focus:ring-red-400 focus:outline-none text-white font-bold py-3 px-10 rounded-full transition-colors shadow-md">
          Get a Quote
        </button>
      </div>
    </form>
  </main>

  <script>
    // ==== Global State ====
    let unitSystem = 'imperial'; // or 'metric'
    const packages = [];

    // Utility: To toggle unit system styles and update placeholders/labels
    function updateUnitLabels() {
      const dimLabelEls = document.querySelectorAll('#unit-dim-label');
      const weightLabelEls = document.querySelectorAll('#unit-weight-label');
      const lengthEl = document.getElementById('length');
      const widthEl = document.getElementById('width');
      const heightEl = document.getElementById('height');
      const weightEl = document.getElementById('weight');
      if(unitSystem === 'imperial') {
        dimLabelEls.forEach(el => el.textContent = 'inches');
        weightLabelEls.forEach(el => el.textContent = 'Lbs');
        lengthEl.placeholder = 'Length';
        widthEl.placeholder = 'Width';
        heightEl.placeholder = 'Height';
        weightEl.placeholder = 'Lbs';
      } else {
        dimLabelEls.forEach(el => el.textContent = 'cm');
        weightLabelEls.forEach(el => el.textContent = 'Kg');
        lengthEl.placeholder = 'Length';
        widthEl.placeholder = 'Width';
        heightEl.placeholder = 'Height';
        weightEl.placeholder = 'Kg';
      }
    }

    // ==== Tabs ====
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
      tab.addEventListener('click', (e) => {
        e.preventDefault();
        // Activate clicked tab and deactivate others
        tabs.forEach(t => {
          t.classList.remove('active');
          t.setAttribute('aria-selected', 'false');
        });
        tab.classList.add('active');
        tab.setAttribute('aria-selected', 'true');
        // For this demo UI, tab changes don't change form fields, but could in real app
      });
    });

    // ==== Unit toggle ====
    const unitToggle = document.getElementById('unit-toggle');
    const unitLabelImperial = document.getElementById('unit-label-imperial');
    const unitLabelMetric = document.getElementById('unit-label-metric');
    function setUnitToggleUI() {
      if(unitSystem === 'imperial') {
        unitToggle.classList.remove('checked');
        unitToggle.setAttribute('aria-checked', 'false');
        unitLabelImperial.classList.remove('text-gray-500');
        unitLabelImperial.classList.add('text-gray-900');
        unitLabelMetric.classList.remove('text-gray-900');
        unitLabelMetric.classList.add('text-gray-500');
      } else {
        unitToggle.classList.add('checked');
        unitToggle.setAttribute('aria-checked', 'true');
        unitLabelImperial.classList.remove('text-gray-900');
        unitLabelImperial.classList.add('text-gray-500');
        unitLabelMetric.classList.remove('text-gray-500');
        unitLabelMetric.classList.add('text-gray-900');
      }
      updateUnitLabels();
    }
    unitToggle.addEventListener('click', () => {
      unitSystem = (unitSystem === 'imperial') ? 'metric' : 'imperial';
      setUnitToggleUI();
    });
    unitToggle.addEventListener('keydown', e => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        unitToggle.click();
      }
    });
    setUnitToggleUI();

    // ==== Package List Handling ====
    const packageListEl = document.getElementById('package-list');
    const addPackageBtn = document.getElementById('add-package');

    function renderPackages() {
      packageListEl.innerHTML = '';
      if(packages.length === 0) {
        packageListEl.innerHTML = '<li class="text-gray-500 text-sm select-none">No packages added yet.</li>';
        return;
      }
      packages.forEach((pkg, idx) => {
        const li = document.createElement('li');
        li.className = "bg-white border border-gray-300 rounded-lg p-3 flex justify-between items-center shadow-sm";
        li.setAttribute('role', 'group');
        li.setAttribute('aria-label', `Package ${idx+1} with dimensions ${pkg.length} x ${pkg.width} x ${pkg.height} and weight ${pkg.weight} ${unitSystem === 'imperial' ? 'Lbs' : 'Kg'}`);
        li.innerHTML = `
          <div class="text-gray-700 font-medium">
            #${idx + 1}: 
            ${pkg.length} x ${pkg.width} x ${pkg.height} ${unitSystem === 'imperial' ? 'in' : 'cm'},
            ${pkg.weight} ${unitSystem === 'imperial' ? 'Lbs' : 'Kg'}
          </div>
          <button aria-label="Remove Package ${idx+1}" class="text-red-600 hover:text-red-800 focus:outline-none focus:ring-2 focus:ring-red-600 rounded" data-idx="${idx}">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        `;
        packageListEl.appendChild(li);
      });
    }

    addPackageBtn.addEventListener('click', () => {
      const length = parseFloat(document.getElementById('length').value);
      const width = parseFloat(document.getElementById('width').value);
      const height = parseFloat(document.getElementById('height').value);
      const weight = parseFloat(document.getElementById('weight').value);

      // Input validation:
      const isValid = (
        !isNaN(length) && length > 0 &&
        !isNaN(width) && width > 0 &&
        !isNaN(height) && height > 0 &&
        !isNaN(weight) && weight > 0
      );
      if(!isValid){
        alert('Please enter valid positive numbers for all dimensions and weight to add a package.');
        return;
      }

      // Add package to list
      packages.push({ length, width, height, weight });

      // Clear inputs
      document.getElementById('length').value = '';
      document.getElementById('width').value = '';
      document.getElementById('height').value = '';
      document.getElementById('weight').value = '';

      renderPackages();
    });

    packageListEl.addEventListener('click', e => {
      if(e.target.closest('button[data-idx]')) {
        const idx = parseInt(e.target.closest('button').dataset.idx);
        if(!isNaN(idx)) {
          packages.splice(idx, 1);
          renderPackages();
        }
      }
    });

    renderPackages();

    // ==== Form Submission / API call ====
    const form = document.getElementById('shipping-form');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Basic validation
      const fromCountry = form.fromCountry.value;
      const toCountry = form.toCountry.value;
      const fromPostal = form.fromPostal.value.trim();
      const toPostal = form.toPostal.value.trim();
      if(!fromCountry || !toCountry) {
        alert('Please select both shipping from and shipping to countries.');
        return;
      }
      if(packages.length === 0) {
        alert('Please add at least one package to get a quote.');
        return;
      }

      // Example Payload (simplified)
      const payload = {
        from: {
          country: fromCountry,
          postalCode: fromPostal,
          city: form.fromCity.value.trim(),
          residential: form.fromResidential.checked
        },
        to: {
          country: toCountry,
          postalCode: toPostal,
          city: form.toCity.value.trim(),
          residential: form.toResidential.checked
        },
        units: unitSystem,
        packages: packages.map(pkg => ({
          length: pkg.length,
          width: pkg.width,
          height: pkg.height,
          weight: pkg.weight
        }))
      };

      try {
        // Sample Purolator API call (mock)
        // Replace YOUR_API_KEY_HERE with your actual Purolator API key
        /*
        const PUROLATOR_API_KEY = 'YOUR_API_KEY_HERE';
        const response = await fetch('https://api.purolator.com/purolator-api-endpoint', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${PUROLATOR_API_KEY}`
          },
          body: JSON.stringify(payload)
        });
        if(!response.ok) {
          throw new Error('Network response was not ok');
        }
        const data = await response.json();
        alert('Quote received: ' + JSON.stringify(data));
        */

        // For demo, just show JSON payload in alert
        alert('Pretend-API Call Payload:\n' + JSON.stringify(payload, null, 2));
      } catch(err) {
        alert('Error getting quote: ' + err.message);
      }
    });
  </script>
</body>
</html>

